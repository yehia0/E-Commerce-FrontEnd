<h2 class="section-title">Profile Information</h2>

<div *ngIf="isLoading" class="loading">Loading...</div>

<div *ngIf="!isLoading && profile">
  <!-- View Mode -->
  <div *ngIf="!isEditing" class="profile-view">
    <div class="profile-field">
      <label>Name</label>
      <p>{{ profile.firstName }} {{ profile.lastName }}</p>
    </div>
    <div class="profile-field">
      <label>Email</label>
      <p>{{ profile.email }}</p>
    </div>
    <div class="profile-field">
      <label>Mobile Number</label>
      <p>{{ profile.phone }}</p>
    </div>
    <div class="profile-field">
      <label>Role</label>
      <p>{{ profile.role }}</p>
    </div>
    <div class="profile-field">
      <label>Member Since</label>
      <p>{{ formatDate(profile.createdAt) }}</p>
    </div>
    <button type="button" class="btn btn-primary" (click)="toggleEdit()">
      Edit Profile
    </button>
  </div>

  <!-- Edit Mode -->
  <form *ngIf="isEditing" (ngSubmit)="saveProfile()">
    <div class="form-row">
      <div class="form-group">
        <label>First Name *</label>
        <input type="text" [(ngModel)]="editForm.firstName" name="firstName" required>
      </div>
      <div class="form-group">
        <label>Last Name *</label>
        <input type="text" [(ngModel)]="editForm.lastName" name="lastName" required>
      </div>
    </div>

    <div class="form-group">
      <label>Email</label>
      <input type="email" [value]="profile.email" name="email" disabled>
      <small>Email cannot be changed</small>
    </div>

    <div class="form-group">
      <label>Mobile Number *</label>
      <input type="tel" [(ngModel)]="editForm.phone" name="phone" required>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary" [disabled]="!isFormValid()">
        Save Changes
      </button>
      <button type="button" class="btn btn-secondary" (click)="toggleEdit()">
        Cancel
      </button>
    </div>
  </form>
</div>

<h3 class="subsection-title">Change Password</h3>

<button
  *ngIf="!showPasswordForm"
  type="button"
  class="btn btn-secondary"
  (click)="togglePasswordForm()">
  Change Password
</button>

<form *ngIf="showPasswordForm" (ngSubmit)="changePassword()">
  <div class="form-group">
    <label>Current Password *</label>
    <input
      type="password"
      [(ngModel)]="passwordForm.currentPassword"
      name="currentPassword"
      required>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label>New Password *</label>
      <input
        type="password"
        [(ngModel)]="passwordForm.newPassword"
        name="newPassword"
        minlength="6"
        required>
      <small>Minimum 6 characters</small>
    </div>
    <div class="form-group">
      <label>Confirm Password *</label>
      <input
        type="password"
        [(ngModel)]="passwordForm.confirmPassword"
        name="confirmPassword"
        required>
    </div>
  </div>

  <div class="form-actions">
    <button type="submit" class="btn btn-primary" [disabled]="!isPasswordFormValid()">
      Change Password
    </button>
    <button type="button" class="btn btn-secondary" (click)="togglePasswordForm()">
      Cancel
    </button>
  </div>
</form>
