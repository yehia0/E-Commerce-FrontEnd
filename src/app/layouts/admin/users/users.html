<div class="users-page">
  <!-- Loading Overlay -->
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="spinner"></div>
    <p>Loading users...</p>
  </div>

  <!-- Stats Grid -->
  <div class="stats-grid">
    <div *ngFor="let stat of stats" [class]="'stat-card stat-' + stat.color">
      <div class="stat-content">
        <div class="stat-info">
          <p class="stat-label">{{ stat.label }}</p>
          <p class="stat-value">{{ stat.value }}</p>
        </div>
        <div class="stat-icon">
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
          </svg>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters Card -->
  <div class="filters-card">
    <div class="filters-wrapper">
      <div class="search-box">
        <input
          type="text"
          [(ngModel)]="searchTerm"
          placeholder="Search users by name, email, or phone..."
          class="search-input"
        />
        <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
      </div>

      <select [(ngModel)]="roleFilter" class="filter-select">
        <option value="all">All Roles</option>
        <option value="admin">Admin</option>
        <option value="customer">Customer</option>
      </select>

      <select [(ngModel)]="statusFilter" class="filter-select">
        <option value="all">All Status</option>
        <option value="active">Active</option>
        <option value="inactive">Inactive</option>
        <option value="suspended">Suspended</option>
      </select>

      <button (click)="openCreateModal()" class="btn-add">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20" style="margin-right: 0.5rem;">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
        </svg>
        Add User
      </button>
    </div>
  </div>

  <!-- Users Table -->
  <div class="table-card">
    <div class="table-wrapper">
      <table class="users-table">
        <thead>
          <tr>
            <th>User</th>
            <th>Contact</th>
            <th>Role</th>
            <th>Status</th>
            <th>Join Date</th>
            <th>Orders</th>
            <th>Total Spent</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of filteredUsers">
            <td>
              <div class="user-cell">
                <div class="user-avatar">
                  {{ (user.name || 'U').charAt(0).toUpperCase() }}
                </div>
                <div class="user-details">
                  <span class="user-name">{{ user.name || 'Unknown' }}</span>
                  <span class="user-id">ID: {{ user.id || '-' }}</span>
                </div>
              </div>
            </td>
            <td>
              <div class="contact-info">
                <span class="contact-email">{{ user.email }}</span>
                <span class="contact-phone">{{ user.phone || '-' }}</span>
              </div>
            </td>
            <td>
              <span [class]="'role-badge role-' + user.role">
                {{ user.role }}
              </span>
            </td>
            <td>
              <button
                (click)="toggleUserStatus(user)"
                [class]="'status-badge status-' + user.status">
                {{ user.status }}
              </button>
            </td>
            <td>
              <span class="date-text">{{ user.joinDate || '-' }}</span>
            </td>
            <td>
              <span class="orders-count">{{ user.totalOrders || 0 }}</span>
            </td>
            <td>
              <span class="spent-amount">{{ user.totalSpent || 0 }} EGP</span>
            </td>
            <td>
              <div class="actions-cell">
                <button
                  (click)="viewUser(user)"
                  class="btn-action btn-view"
                  title="View User">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                  </svg>
                </button>
                <button
                  (click)="openEditModal(user)"
                  class="btn-action btn-edit"
                  title="Edit User">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                  </svg>
                </button>
                <button
                  (click)="deleteUser(user)"
                  class="btn-action btn-delete"
                  title="Delete User">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && filteredUsers.length === 0" class="empty-state">
      <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
      </svg>
      <h3 class="empty-title">No users found</h3>
      <p class="empty-text">Try adjusting your search or filter criteria</p>
    </div>
  </div>

  <!-- Modal -->
  <div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ editingUser?._id || editingUser?.id ? 'Edit User' : 'Create New User' }}</h2>
        <button class="close-btn" (click)="closeModal()">&times;</button>
      </div>

      <form (submit)="saveUser(); $event.preventDefault()">
        <div class="modal-body">
          <div class="form-row">
            <div class="form-group">
              <label>Full Name *</label>
              <input
                type="text"
                [(ngModel)]="editingUser!.name"
                name="name"
                required
                placeholder="e.g., Ahmed Mohamed"
              />
            </div>

            <div class="form-group">
              <label>Email *</label>
              <input
                type="email"
                [(ngModel)]="editingUser!.email"
                name="email"
                required
                placeholder="user@example.com"
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Phone</label>
              <input
                type="tel"
                [(ngModel)]="editingUser!.phone"
                name="phone"
                placeholder="+20 100 000 0000"
              />
            </div>

            <div class="form-group">
              <label>Password {{ editingUser?._id || editingUser?.id ? '(Leave empty to keep current)' : '*' }}</label>
              <input
                type="password"
                [(ngModel)]="editingUser!.password"
                name="password"
                [required]="!(editingUser?._id || editingUser?.id)"
                placeholder="••••••••"
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Role</label>
              <select [(ngModel)]="editingUser!.role" name="role">
                <option value="customer">Customer</option>
                <option value="admin">Admin</option>
              </select>
            </div>

            <div class="form-group">
              <label>Status</label>
              <select [(ngModel)]="editingUser!.status" name="status">
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="suspended">Suspended</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Address</label>
            <textarea
              [(ngModel)]="editingUser!.address"
              name="address"
              placeholder="Full address..."
            ></textarea>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" (click)="closeModal()" class="btn-cancel">
            Cancel
          </button>
          <button type="submit" class="btn-save">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20" style="margin-right: 0.5rem;">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            {{ editingUser?._id || editingUser?.id ? 'Update User' : 'Create User' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- View User Modal -->
  <div *ngIf="showViewModal" class="modal-overlay" (click)="closeViewModal()">
    <div class="modal-content view-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>User Details</h2>
        <button class="close-btn" (click)="closeViewModal()">&times;</button>
      </div>

      <div class="modal-body" *ngIf="viewingUser">
        <div class="user-profile">
          <div class="profile-avatar">
            {{ (viewingUser.name || 'U').charAt(0).toUpperCase() }}
          </div>
          <h3 class="profile-name">{{ viewingUser.name || 'Unknown' }}</h3>
          <p class="profile-email">{{ viewingUser.email || '-' }}</p>
        </div>

        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">User ID</span>
            <span class="info-value">{{ viewingUser.id }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Phone</span>
            <span class="info-value">{{ viewingUser.phone || '-' }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Role</span>
            <span [class]="'role-badge role-' + viewingUser.role">{{ viewingUser.role }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Status</span>
            <span [class]="'status-badge status-' + viewingUser.status">{{ viewingUser.status }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Join Date</span>
            <span class="info-value">{{ viewingUser.joinDate || '-' }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Total Orders</span>
            <span class="info-value">{{ viewingUser.totalOrders || 0 }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Total Spent</span>
            <span class="info-value">{{ viewingUser.totalSpent || 0 }} EGP</span>
          </div>
          <div class="info-item full-width" *ngIf="viewingUser.address">
            <span class="info-label">Address</span>
            <span class="info-value">{{ viewingUser.address }}</span>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" (click)="closeViewModal()" class="btn-cancel">
          Close
        </button>
        <button type="button" (click)="editFromView()" class="btn-save">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20" style="margin-right: 0.5rem;">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
          </svg>
          Edit User
        </button>
      </div>
    </div>
  </div>
</div>
<app-confirmation-modal
  [config]="confirmConfig"
  [isVisible]="showConfirmModal"
  (confirmed)="onModalConfirm()"
  (cancelled)="onModalCancel()">
</app-confirmation-modal>
